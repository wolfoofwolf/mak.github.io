<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æº«æ¿•åº¦èˆ‡ç«ç„°ç›£æ§</title>
    <style>
        body { margin:0; padding:0; font-family:system-ui,sans-serif; background:#111; color:#eee; }
        .top-bar { background:#1a1a1a; padding:15px 20px; display:flex; align-items:center; justify-content:space-between; }
        .menu-btn { font-size:1.8rem; cursor:pointer; }
        .title { font-size:1.4rem; margin:0; }
        .container { max-width:500px; margin:30px auto; background:#1a1a1a; border-radius:12px; padding:30px; }
        .data-box { background:#222; border-radius:10px; padding:20px; margin:15px 0; font-size:1.4rem; }
        .temp { color:#ff9800; }
        .humid { color:#4fc3f7; }
        .flame-normal { background:#222; color:#4caf50; }
        .flame-alert { background:#b71c1c; color:white; font-weight:bold; }
        .time { font-size:0.9rem; color:#888; margin-top:20px; }
        .buttons { display:flex; justify-content:center; gap:15px; margin-top:30px; }
        button { padding:12px 24px; font-size:1rem; border:none; border-radius:8px; cursor:pointer; background:#333; color:white; }
        .version { position:fixed; bottom:10px; right:20px; font-size:0.8rem; color:#555; }
    </style>
</head>
<body>

<div class="top-bar">
    <div class="menu-btn" onclick="openMenu()">â˜°</div>
    <h1 class="title">æº«æ¿•åº¦èˆ‡ç«ç„°ç›£æ§</h1>
    <div></div>
</div>

<div class="container">
    <div class="data-box"><span class="temp" id="tempDisplay">Temperature: -- Â°C ğŸŒ¡ï¸</span></div>
    <div class="data-box"><span class="humid" id="humidDisplay">Humidity: -- % ğŸ’§</span></div>
    <div class="data-box" id="flameBox"><span id="flameDisplay">Flame Status: -- ğŸ”¥</span></div>
    <div class="time" id="updateTime">Last updated: loading...</div>

    <div class="buttons">
        <button onclick="updateData()">Refresh Data</button>
        <button class="auto-mode" onclick="controlLed('auto', 1)">Restore Auto Mode</button>
        <button class="all-off" onclick="controlLed('all', 0)">All Light OFF</button>
    </div>
</div>

<div class="version">ç‰ˆæœ¬ï¼šv2.2 - 2026/02/06</div>

<div id="sidebar" class="sidebar" style="height:100%; width:0; position:fixed; z-index:10; top:0; left:0; background:#111; overflow-x:hidden; transition:0.5s; padding-top:60px; box-shadow:2px 0 10px rgba(0,0,0,0.8);">
    <a href="javascript:void(0)" class="closebtn" onclick="closeMenu()">Ã—</a>
    <a href="#" onclick="showNotificationRules()">Notification Rules</a>
    <a href="#" onclick="showActions()">Actions</a>
</div>

<script>
const channelID = 3252434;
const readAPIKey = "PKQNQOPCZYREXB6C";
const espIP = "http://192.168.1.140";

function updateData() {
    fetch(`https://api.thingspeak.com/channels/${channelID}/fields/1/last.json?api_key=${readAPIKey}`)
        .then(r => r.json())
        .then(d => {
            const temp = d.field1 ? Number(d.field1).toFixed(1) : '--';
            document.getElementById('tempDisplay').textContent = `Temperature: ${temp} Â°C ğŸŒ¡ï¸`;
        });

    fetch(`https://api.thingspeak.com/channels/${channelID}/fields/2/last.json?api_key=${readAPIKey}`)
        .then(r => r.json())
        .then(d => {
            const humid = d.field2 ? Number(d.field2).toFixed(1) : '--';
            document.getElementById('humidDisplay').textContent = `Humidity: ${humid} % ğŸ’§`;
        });

    fetch(`https://api.thingspeak.com/channels/${channelID}/fields/3/last.json?api_key=${readAPIKey}`)
        .then(r => r.json())
        .then(d => {
            const flame = d.field3;
            let text = '--';
            let cls = 'flame-normal';
            if (flame == 0) { text = "Flame Detected! ğŸ”¥"; cls = 'flame-alert'; }
            else if (flame == 1) { text = "No Flame âœ…"; cls = 'flame-normal'; }
            document.getElementById('flameDisplay').textContent = `Flame Status: ${text}`;
            document.getElementById('flameBox').className = 'data-box ' + cls;
        });

    document.getElementById('updateTime').textContent = `Last updated: ${new Date().toLocaleString('zh-TW')}`;
}

function controlLed(type, state) {
    fetch(`${espIP}/led?type=${type}&state=${state}`)
        .then(r => r.text())
        .then(text => console.log("æ§åˆ¶æˆåŠŸ: " + text))
        .catch(err => console.error("æ§åˆ¶éŒ¯èª¤:", err));
}

setInterval(updateData, 20000);
updateData();

// å´é‚Šæ¬„æ§åˆ¶
function openMenu() { document.getElementById("sidebar").style.width = "280px"; }
function closeMenu() { document.getElementById("sidebar").style.width = "0"; }

// å ä½å‡½æ•¸ï¼ˆå…ˆè®“é¸å–®èƒ½é»ï¼‰
function showActions() { alert("Actions é é¢ï¼ˆç›®å‰æ­£å¸¸ï¼‰"); }
function showNotificationRules() { alert("Notification Rules é é¢ï¼ˆå³å°‡åŠ å…¥ï¼‰"); }
</script>
</body>
</html>
